---
import Layout from './Layout.astro';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  featuredImage?: {
    url: string;
    alt: string;
  };
}

const { title, description, pubDate: rawPubDate, featuredImage } = Astro.props;

// Ensure we have a valid date object
let pubDate;

try {
  if (rawPubDate instanceof Date) {
    pubDate = rawPubDate;
  } else if (typeof rawPubDate === 'string') {
    // First try parsing as ISO string
    pubDate = new Date(rawPubDate);
    
    // If that fails, try parsing as YYYY-MM-DD
    if (isNaN(pubDate.getTime()) && rawPubDate.includes('-')) {
      const parts = rawPubDate.split('T')[0].split('-');
      if (parts.length === 3) {
        const [year, month, day] = parts.map(num => parseInt(num, 10));
        pubDate = new Date(year, month - 1, day);
      }
    }
  }

  // Final validation
  if (!pubDate || isNaN(pubDate.getTime())) {
    throw new Error('Invalid date');
  }
} catch (error) {
  throw new Error(`Invalid date format for pubDate: ${rawPubDate}. Please use YYYY-MM-DD or ISO format.`);
}
---

<Layout title={title} description={description}>
  <article class="mx-auto max-w-[750px] px-4">
    {featuredImage && (
      <img
        src={featuredImage.url}
        alt={featuredImage.alt}
        class="w-full h-[400px] object-cover rounded-lg mb-8"
      />
    )}
    <h1 class="text-4xl font-bold mb-4">{title}</h1>
    <div class="text-gray-600 dark:text-gray-400 mb-8">
      <time datetime={pubDate.toISOString()}>
        {pubDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
        })}
      </time>
    </div>
    <div class="prose dark:prose-invert max-w-none">
      <slot />
    </div>
    <slot name="pagination" />
  </article>
  <slot name="cta" />
</Layout>
